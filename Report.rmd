Exploration and analysis of the WHO mortality database.

This notebook walks us trough a typical workflow of data analysis. From tiding the data to appling a linear regression modell and in the end communicate the results of our analysis.
We dont want to show some kind of typical textbook example. Our goal is to display the real process. This means that we will ask questions about the data in our dataset and answer them with transformation and visualisation techniques. 
In the end we want to apply a feasible linear regression model in order to gain insight into the futre development of the data.

To do all this we use the WHO mortality database, which lists all kinds of possibile types of deaths in the WHO member states.
The members of the WHO report the data from their civil registration systems into the database annually. We use the ICD-9 version which ranges from 1979 to 2017.

This are the sources from the WHO.
https://www.who.int/data/data-collection-tools/who-mortality-database

Packages
All the needed packages and librarys are defined here.
```{r, setup, include=FALSE}
knitr::opts_knit$set(root.dir = 'C:/Users/Jan/Documents/GitHub/DASC/resources')
library(dplyr)
library(ggplot2)
```

Import
We import these different files into R. The countrycodes file connects the countrys number to the name. Morticd9 is the mortality dataset itself. The population file contains informations about the population divided into the different age groups. All files expect the detailedcauses can be found in our source. In order to get the detailed causes as a .csv file we copied the table from the word file into excel and then exported it as csv.

```{r}
countrycodes <- read.csv("country_codes")
mortalityicd9 <- read.csv("Morticd9")
population <- read.csv("pop")
detailedcause <- read.csv(file = "ICD-9BTL.csv", head = TRUE, sep=";")
```
Restricting the dataset

We want to compare communist and democratic countries during the cold war. Only countries that were either in the NATO or in the warsaw pact, until 1991 apply. Unfurtunatly our dataset is inconsistent because it does not ranges from the begining of Nato or the cold war. Therefore we only use data ranging from 1979 to 1991. 
The Nato countries that are part of our data set are:
USA, Canada, Portugal, Turkey, Greece, Italy, Austria, France, West Germany, Belgium,Luxembourg, Netherlands, Britan, Norway, Iceland. 

The warsaw pact countries in our dataset are:
Albania, Bulgaria, East Germany, Poland, Rumania, UDSSR, Czechoslovakia, Hungary.

Splitting the Dataset

We split the raw data and afterwards tidy it. This code is used to split the data.
```{r}
#List or Vector of countries have to check that
countryslist <- c("United States of America", "Canada", "Portugal", "Turkey", "Greece", "Germany, Former Democratic Republic", "Germany, Former Federal Republic", "	
Germany, West Berlin", "Austria", "France", "Belgium", "Luxembourg", "Netherlands", "United Kingdom", "Norway", "Iceland", "Albania", "Bulgaria", "Poland", "Rumania", "USSR, Former","Czechoslovakia, Former", "Hungary")

coldwarcountrys <- data.frame(matrix(unlist(countryslist), nrow=length(countryslist), byrow=T))%>%
  rename("countryname" = "matrix.unlist.countryslist...nrow...length.countryslist...byrow...T.")

splitdataset <- mortalityicd9 %>%
  subset(Year >= 1979 & Year <= 1991) %>%
  left_join(countrycodes, by = c("Country" = "country"))%>%
  rename("countryname" = "name") %>%
  semi_join(coldwarcountrys)
```

Tidying the dataset

The death cause categories are divided into two different types. The "Detailed List Numbers" which are numbers connected to a cause and the BTL (Basic Tabulation List). BTL categorizes the numbers, for example B24 contains the numbers 380-389. But BTL is further divided, so B240 is a subcategory of B24 containing the numbers 381-383.
In the dataset B24 also contains all deaths of its subcategories. The the targetet audience of this document are no health experts. Therefore only the BTL categories with two numbers are included.
The columns Deaths2, Deaths3,... stand for age groups, but Deaths1 sums up all age groups and Infants.
Therefore all other death columns get excluded.
In the Documentation there is a chapter 17 for ICD-9 all these "Detailed List Numbers" are already included in the BTL categories. Therefore they get thrown out.

```{r}
dataset <- splitdataset %>%
  subset(select = c(1, 4, 6, 7, 10, 40))%>%
  select(countryname, Country, Year, Cause, Sex, Deaths1)%>%
  rename("Deathcount" = "Deaths1")%>%
  subset(grepl("^B\\d{0,2}$", Cause))

subcategories <- splitdataset%>%
  subset(select = c(1, 4, 6, 7, 10, 40))%>%
  select(countryname, Country, Year, Cause, Sex, Deaths1)%>%
  rename("Deathcount" = "Deaths1")%>%
  subset(!grepl("^B\\d{0,2}$", Cause))%>%
  subset(grepl("^B", Cause)) #I dunno why I had to do this twice in order to eliminate numbers
```

Question1
Is the suicide rate higher in countries part of the warsaw pact?
```{r}
suiciderate <- dataset%>%
  filter(Cause == "B54")

suiciderateussr <-  suiciderate%>%
  filter(countryname == "USSR, Former")

ggplot(data = suiciderateussr)+
  geom_point(mapping = aes(x = Year, y = Deathcount))
```

